<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <link rel="stylesheet" href="./resources/ol.css">
    <link rel="stylesheet" href="resources/fontawesome-all.min.css">
    <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
    <link rel="stylesheet" href="./resources/qgis2web.css">
    <style>
        html, body, #map { width: 100%; height: 100%; padding: 0; margin: 0; }
        .ol-control > * { background-color: #f8f8f8!important; color: #444!important; border-radius: 0px; }
        .ol-control { background-color: rgba(255,255,255,.4) !important; padding: 2px !important; }
    </style>
    <title>25182_Masquelier</title>
<head>
    <style>
        #logo-container {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
        }

        #map-logo {
            width: 120px;     /* taille contrôlée */
            opacity: 0.9;
            border-radius: 6px;
        }
    </style>
    <title>25182_Masquelier</title>
</head>

<body>

    <div id="logo-container">
        <img src="images/TER_def avec texte.jpg" id="map-logo">
    </div>

    <div id="map">
        <div id="popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>
    </div>

    <!-- Scripts qgis2web et couches -->
    <script src="resources/qgis2web_expressions.js"></script>
    <script src="./resources/functions.js"></script>
    <script src="./resources/ol.js"></script>
    <script src="./resources/ol-layerswitcher.js"></script>
    <script src="resources/photon-geocoder-autocomplete.min.js"></script>
    <script src="layers/Implantation_batiment_3.js"></script>
    <script src="layers/Arbres_4.js"></script>
    <script src="styles/Implantation_batiment_3_style.js"></script>
    <script src="styles/Arbres_4_style.js"></script>
    <script src="./layers/layers.js"></script> 
    <script src="./resources/Autolinker.min.js"></script>
    <script src="./resources/qgis2web.js"></script>

    <!-- Script popup personnalisé -->
<script>
window.onload = function() {
    var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');
    var closer = document.getElementById('popup-closer');

    var overlay = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: { duration: 250 }
    });

    closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
    };

    map.addOverlay(overlay);

    map.on('singleclick', function(evt) {
        var feature = map.forEachFeatureAtPixel(evt.pixel, function(f) { return f; });
        if (feature) {
            // Champs à afficher dans la table
            var fields = ['_record_id', 'pos_id', 'arb_vern','arb_brin_nb', 'arb_circ', 'ges_pot','ges_comment', 'photo_url'];

            // Mapping des noms de champs vers des labels lisibles
            var labels = {
                '_record_id': 'ID',
                'pos_id': 'Position ID',
                'arb_vern': 'Nom vernaculaire',
                 'arb_brin_nb': 'Nombre de troncs',
                'arb_circ': 'Circonférence (cm)',
                'ges_pot': 'Gestion potentielle',
                'ges_comment': 'Commentaire',
                'photo_url': 'Photo'
            };

            var html = '<table>';

            fields.forEach(function(f) {
                var val = feature.get(f) || '';
                var label = labels[f] || f; // Utilise le label si défini, sinon le nom du champ

                if(f === 'photo_url' && val) {
                    html += '<tr><th>' + label + '</th><td><a href="' + val + '" target="_blank">' + val + '</a></td></tr>';
                } else {
                    html += '<tr><th>' + label + '</th><td>' + val + '</td></tr>';
                }
            });

            html += '</table>';
            content.innerHTML = html;
            overlay.setPosition(evt.coordinate);
        }
    });
};
</script>



</body>
</html>
